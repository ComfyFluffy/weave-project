# weave-project

## 核心
- 类 Discord 的聊天界面
- 建立一个事实库/规则库（世界）供 LLM 使用及主持人查看/修改，解决 LLM 在长聊天中的长期记忆问题
- LLM 融合进故事推进，全面提升游玩体验。辅助玩家/主持人选择剧情，或通过多个 Agent 的模式让 LLM 当玩家/主持人。
- 规则判定。玩家提交 Action 的时候指定
## 外围
- LLM 辅助的世界/角色创建
- LLM 辅助的故事导出
## MVP
- 所有核心功能
- 不需要登陆，玩家进入聊天室/世界后选择或创建角色
- 非必要不使用数据库

```
产品需求文档：Weave (2.0 - AI增强版)
- 项目代号: Weave
- 版本: 2.0
- 核心定位: 一个融合了AI技术、拥有高度自由度的实时在线协作叙事平台。
1. 核心愿景 (Vision)
我们旨在创造一个**"智能化的、永不疲倦的虚拟游戏主持人(GM/DM)"**。
Weave 将打破传统线上跑团（TRPG）的壁垒。它利用强大的人工智能，为玩家提供一个类似Discord的、高度整合的社交与游戏空间。无论是想体验一场无需准备、随时开始的冒险，还是希望为资深主持人提供创作的"灵感副驾"，Weave都将致力于解决传统模式中主持人构思枯竭、规则复杂、节奏拖沓等核心痛点，让创造故事的乐趣变得前所未有的简单和纯粹。
2. 界面与核心流程 (UI/UX & Flow)
整体界面将参考Discord的成熟设计，为用户提供熟悉、直观的体验。
- 服务器/世界列表: 用户可以创建或被邀请加入不同的"世界"（即服务器）。每个世界都是一个独立且持久的故事空间。
- 世界内的频道结构:
  - #世界公告: 用于主持人和AI发布重要信息。
  - #规则与传说 (Rules & Lore): 一个只读频道，存放由AI生成或由玩家自定义的世界观、核心规则。此频道内容是AI的核心知识库。
  - #角色创建: 一个引导式频道，玩家在此创建和管理自己的角色卡。
  - #场外闲聊 (OOC - Out of Character): 供玩家进行游戏外的自由交流。
  - #场景-酒馆相遇, #场景-深入龙穴 等 (IC - In Character): 核心游戏频道，故事在这里实时发生。
3. 核心玩法模式 (Gameplay Modes)
平台提供两种核心模式，满足不同玩家群体的需求。
- 模式A: 全权AI主持人 (AI as Narrator)
  - 描述: 一种完全自动化的"一键开团"体验。AI扮演游戏主持人的全部角色：负责场景描述、扮演所有NPC、裁定玩家行动结果、推进故事发展。
  - 适用人群: TRPG新手、没有固定主持人的朋友团体、想要快速体验一场冒险的玩家。
- 模式B: AI辅助主持人 (AI-Assisted Narrator)
  - 描述: 由一名人类玩家担任主持人，但AI会成为他的"智能副驾"。主持人拥有最终决定权，但可以随时调用AI来获取灵感、生成内容或处理繁琐的规则。
  - 适用人群: 经验丰富的主持人，希望减轻负担、提升故事质量，但不想放弃主导权。
4. AI核心功能：项目的灵魂 (Core AI Features)
这是Weave最具创新性的部分，旨在解决你提到的核心痛点。
功能一: AI主持人或辅助主持人 (AI Narrator/Assistant)
- 痛点解决: 解决主持人构思枯竭、节奏拖沓的问题。
- 功能描述: AI可以全权主持游戏，或作为人类主持人的智能助手。
功能二: AI驱动的选项 (AI-Provided Choices)
- 痛点解决: 解决主持人和玩家的"卡壳"时刻，避免长时间的冷场。
- 功能描述: 在任何时刻，主持人或玩家都可以触发"AI灵感"功能。AI会分析当前上下文，并立刻提供3-4个合乎逻辑的、可供选择的剧情走向或行动选项。
- 示例: 玩家被困在一个地牢里，AI提供选项：
  1. 【环境互动】"你们在墙角一块松动的石头后面，发现了一个隐藏的杠杆。"
  2. 【引入冲突】"另一队探险者突然出现，他们似乎也想要这里的宝藏。"
  3. 【增加变数】"天花板开始震动，似乎随时可能坍塌。"
- 团队可以通过投票来决定采纳哪个选项，快速推动剧情。
功能三: 上下文记忆与状态管理 (Contextual Memory & State Management)
- 痛点解决: 解决大语言模型(LLM)在长篇聊天记录中"遗忘"关键信息的致命问题。
- 我们的解决方案: 我们不依赖LLM的原始记忆力，而是设计一个**"世界状态 (World State)"**的结构化JSON对象，作为AI的"外置硬盘"。
  - world_state.json 结构示例:
{
  "player_status": {
    "玩家A": {"HP": 80, "location": "低语森林", "inventory": ["长剑", "治疗药水"]},
    "玩家B": {"HP": 95, "location": "低语森林", "inventory": ["魔法杖"]}
  },
  "key_events_log": ["国王被刺杀", "古代神器被盗"],
  "npc_status": { "守卫队长": "对玩家B产生了怀疑" }
}
  - 工作流:
    1. 当玩家的行动或故事发展产生了关键变化（如获得物品、进入新地点、NPC态度改变），AI的第一任务是更新world_state.json。
    2. 当AI需要做出下一个决策时，我们喂给它的上下文是经过精心提炼的：[最近的聊天记录] + [相关的世界规则] + [完整的world_state.json]。
    3. 通过这种方式，AI总能基于一个准确、精简的核心事实库来做出判断，从而确保了故事的长期逻辑自洽。
5. 技术栈构想 (Tech Stack)
- 前端: React (用于构建类似Discord的复杂交互界面) + Chakra UI (组件库)
- 后端: Node.js (Express) + Socket.IO (用于处理实时双向通信)
- 数据库: Prisma & PostgreSQL (存储用户数据、世界状态等)
- AI模型: 通过API接入大型语言模型服务 (如 OpenAI API, Google Gemini API)。
6. 技术架构细节
- 项目采用 Monorepo 结构，使用 Yarn Workspaces 管理多个包
- 前端应用使用 Vite 构建工具和 React 框架
- 后端服务使用 Express 和 Socket.IO 实现实时通信
- 共享类型定义通过 @weave/types 包在前后端之间共享
```
